import React, { useState } from "react";\nimport { Card, CardContent, Button, IconButton, Box, Typography, Chip } from '@mui/material';\nimport { Play, FileText, Clock, Trash2 } from "lucide-react";\n\nconst TemplatesPanel = ({ templates, onLoadTemplate, onRunTemplate, onDeleteTemplate, selectedEvent }) => {\n  const [deletingIds, setDeletingIds] = useState(new Set());\n  \n  return (\n    <Box sx={{ p: 3, bgcolor: '#F8F9FA', minHeight: '100%' }} data-testid=\"templates-panel\">\n      <Box sx={{ mb: 3 }}>\n        <Typography variant=\"h3\" sx={{ mb: 0.5 }}>Saved Templates</Typography>\n        <Typography variant=\"body2\" color=\"text.secondary\">Load and execute your saved DSL templates</Typography>\n      </Box>\n\n      {templates.length === 0 ? (\n        <Card sx={{ textAlign: 'center', py: 6 }}>\n          <CardContent>\n            <FileText size={48} color=\"#CED4DA\" style={{ marginBottom: 16 }} />\n            <Typography variant=\"h5\" sx={{ mb: 1 }}>No Templates Yet</Typography>\n            <Typography variant=\"body2\" color=\"text.secondary\">\n              Save your DSL code to create reusable templates\n            </Typography>\n          </CardContent>\n        </Card>\n      ) : (\n        <Box sx={{ display: 'grid', gridTemplateColumns: { xs: '1fr', md: 'repeat(2, 1fr)', lg: 'repeat(3, 1fr)' }, gap: 2 }}>\n          {templates.map((template) => (\n            <Card \n              key={template.id}\n              data-testid={`template-${template.id}`}\n            >\n              <CardContent sx={{ p: 2.5 }}>\n                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>\n                  <Box sx={{ flex: 1 }}>\n                    <Typography variant=\"h6\" sx={{ mb: 0.5 }}>{template.name}</Typography>\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 0.5 }}>\n                      <Clock size={12} color=\"#6C757D\" />\n                      <Typography variant=\"caption\" color=\"text.secondary\">\n                        {new Date(template.created_at).toLocaleDateString()}\n                      </Typography>\n                    </Box>\n                  </Box>\n                  <IconButton\n                    size=\"small\"\n                    onClick={async (e) => {\n                      e.stopPropagation();\n                      const confirmed = window.confirm(`Delete template \"${template.name}\"?`);\n                      if (!confirmed) return;\n\n                      try {\n                        setDeletingIds(prev => new Set(prev).add(template.id));\n                        await onDeleteTemplate(template.id, template.name);\n                      } catch (err) {\n                        console.error('Error deleting template', err);\n                      } finally {\n                        setDeletingIds(prev => {\n                          const copy = new Set(prev);\n                          copy.delete(template.id);\n                          return copy;\n                        });\n                      }\n                    }}\n                    sx={{ color: '#DC3545' }}\n                    data-testid={`delete-template-${template.id}`}\n                    disabled={deletingIds.has(template.id)}\n                  >\n                    <Trash2 size={16} />\n                  </IconButton>\n                </Box>\n\n                <Box sx={{ \n                  bgcolor: '#212529', \n                  borderRadius: 1, \n                  p: 1.5, \n                  mb: 2,\n                  maxHeight: 120,\n                  overflow: 'auto',\n                  fontFamily: 'monospace',\n                  fontSize: '0.75rem',\n                  color: '#F8F9FA',\n                  lineHeight: 1.5\n                }}>\n                  {template.dsl_code}\n                </Box>\n\n                <Box sx={{ display: 'flex', gap: 1 }}>\n                  <Button \n                    variant=\"outlined\" \n                    size=\"small\" \n                    onClick={() => onLoadTemplate(template)}\n                    sx={{ flex: 1 }}\n                    startIcon={<FileText size={16} />}\n                    data-testid={`load-template-${template.id}`}\n                  >\n                    Load\n                  </Button>\n                  <Button \n                    variant=\"contained\"\n                    size=\"small\" \n                    onClick={() => onRunTemplate(template.id)}\n                    disabled={!selectedEvent}\n                    sx={{ flex: 1 }}\n                    startIcon={<Play size={16} />}\n                    data-testid={`run-template-${template.id}`}\n                  >\n                    Run\n                  </Button>\n                </Box>\n              </CardContent>\n            </Card>\n          ))}\n        </Box>\n      )}\n    </Box>\n  );\n};\n\nexport default TemplatesPanel;
